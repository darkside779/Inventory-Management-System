@model InventoryManagement.WebUI.ViewModels.Invoice.InvoiceDetailsViewModel
@{
    ViewData["Title"] = $"Print Invoice - {Model.InvoiceNumber}";
    Layout = null; // No layout for print view
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        @@media print {
            .no-print { display: none !important; }
            .print-break { page-break-after: always; }
            body { 
                font-size: 11px !important; 
                margin: 0.5in !important;
                line-height: 1.2 !important;
            }
            .container-fluid { 
                max-width: 100% !important; 
                padding: 0 !important;
                margin: 0 !important;
            }
            .invoice-header {
                margin-bottom: 15px !important;
                padding-bottom: 10px !important;
            }
            .section-header {
                margin-top: 15px !important;
                margin-bottom: 8px !important;
                padding: 6px 10px !important;
                font-size: 12px !important;
            }
            .info-table td {
                padding: 3px 8px !important;
            }
            .items-table th {
                padding: 6px 4px !important;
                font-size: 10px !important;
            }
            .items-table td {
                padding: 4px 4px !important;
                font-size: 10px !important;
            }
            .totals-section {
                margin-top: 15px !important;
            }
            .totals-table td {
                padding: 3px 8px !important;
                font-size: 11px !important;
            }
            .footer-info {
                margin-top: 20px !important;
                padding-top: 10px !important;
                font-size: 9px !important;
            }
            .company-name {
                font-size: 20px !important;
                margin-bottom: 2px !important;
            }
            .invoice-title {
                font-size: 24px !important;
                margin-bottom: 5px !important;
            }
            .invoice-number {
                font-size: 14px !important;
            }
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            color: #333;
        }
        
        .invoice-header {
            border-bottom: 3px solid #007bff;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .company-info {
            text-align: right;
        }
        
        .company-name {
            font-size: 28px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .invoice-title {
            font-size: 36px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .invoice-number {
            font-size: 18px;
            font-weight: bold;
            color: #666;
        }
        
        .section-header {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-left: 4px solid #007bff;
            font-weight: bold;
            margin-bottom: 15px;
            margin-top: 25px;
        }
        
        .info-table td {
            padding: 8px 12px;
            border: none;
        }
        
        .info-table .label {
            font-weight: bold;
            color: #666;
            width: 120px;
        }
        
        .items-table {
            margin-top: 20px;
        }
        
        .items-table th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            padding: 12px 8px;
            text-align: center;
        }
        
        .items-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .items-table .text-end {
            text-align: right;
        }
        
        .totals-section {
            margin-top: 30px;
        }
        
        .totals-table {
            width: 300px;
            margin-left: auto;
        }
        
        .totals-table td {
            padding: 8px 15px;
            border: none;
        }
        
        .totals-table .total-row {
            border-top: 2px solid #007bff;
            font-weight: bold;
            font-size: 16px;
            background-color: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .status-draft { background-color: #6c757d; color: white; }
        .status-sent { background-color: #17a2b8; color: white; }
        .status-paid { background-color: #28a745; color: white; }
        .status-overdue { background-color: #dc3545; color: white; }
        .status-cancelled { background-color: #6c757d; color: white; }
        
        .footer-info {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            font-size: 12px;
            color: #666;
        }
        
        .print-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        @@media print {
            .print-controls { display: none; }
        }
    </style>
</head>
<body>
    <!-- Print Controls -->
    <div class="print-controls no-print">
        <button onclick="window.print()" class="btn btn-primary me-2">
            <i class="fas fa-print"></i> Print
        </button>
        <button onclick="window.close()" class="btn btn-secondary">
            <i class="fas fa-times"></i> Close
        </button>
    </div>

    <div class="container-fluid">
        <!-- Invoice Header -->
        <div class="invoice-header">
            <div class="row">
                <div class="col-md-6">
                    <div class="invoice-title">INVOICE</div>
                    <div class="invoice-number">#@Model.InvoiceNumber</div>
                </div>
                <div class="col-md-6 company-info">
                    <div class="company-name">Inventory Management System</div>
                    <div>Your Company Address</div>
                    <div>City, State, ZIP Code</div>
                    <div>Phone: (555) 123-4567</div>
                    <div>Email: info@yourcompany.com</div>
                </div>
            </div>
        </div>

        <!-- Invoice Information -->
        <div class="row">
            <div class="col-md-6">
                <div class="section-header">Bill To</div>
                <table class="info-table">
                    <tr>
                        <td class="label">Customer:</td>
                        <td><strong>@Model.CustomerName</strong></td>
                    </tr>
                    @if (!string.IsNullOrEmpty(Model.CompanyName))
                    {
                        <tr>
                            <td class="label">Company:</td>
                            <td>@Model.CompanyName</td>
                        </tr>
                    }
                    @if (!string.IsNullOrEmpty(Model.CustomerEmail))
                    {
                        <tr>
                            <td class="label">Email:</td>
                            <td>@Model.CustomerEmail</td>
                        </tr>
                    }
                    @if (!string.IsNullOrEmpty(Model.CustomerPhone))
                    {
                        <tr>
                            <td class="label">Phone:</td>
                            <td>@Model.CustomerPhone</td>
                        </tr>
                    }
                </table>
            </div>
            <div class="col-md-6">
                <div class="section-header">Invoice Details</div>
                <table class="info-table">
                    <tr>
                        <td class="label">Invoice Date:</td>
                        <td>@Model.InvoiceDate.ToString("MMMM dd, yyyy")</td>
                    </tr>
                    <tr>
                        <td class="label">Due Date:</td>
                        <td>@Model.DueDate.ToString("MMMM dd, yyyy")</td>
                    </tr>
                    @if (!string.IsNullOrEmpty(Model.PaymentTerms))
                    {
                        <tr>
                            <td class="label">Payment Terms:</td>
                            <td>@Model.PaymentTerms</td>
                        </tr>
                    }
                    <tr>
                        <td class="label">Status:</td>
                        <td>
                            <span class="status-badge status-@Model.Status.ToLower()">
                                @Model.Status
                            </span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Invoice Items -->
        <div class="section-header">Invoice Items</div>
        
        @if (Model.Items.Any())
        {
            <table class="table table-bordered items-table">
                <thead>
                    <tr>
                        <th style="width: 40%;">Product</th>
                        <th style="width: 10%;">Qty</th>
                        <th style="width: 15%;">Unit Price</th>
                        <th style="width: 10%;">Discount</th>
                        <th style="width: 10%;">Tax</th>
                        <th style="width: 15%;">Line Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Items)
                    {
                        <tr>
                            <td>
                                <strong>@item.ProductName</strong>
                                @if (!string.IsNullOrEmpty(item.ProductSku))
                                {
                                    <br><small class="text-muted">SKU: @item.ProductSku</small>
                                }
                                @if (!string.IsNullOrEmpty(item.Description))
                                {
                                    <br><small class="text-muted">@item.Description</small>
                                }
                            </td>
                            <td class="text-center">@item.Quantity</td>
                            <td class="text-end">@item.UnitPrice.ToString("C")</td>
                            <td class="text-center">@item.DiscountPercentage.ToString("0.##")%</td>
                            <td class="text-center">@item.TaxPercentage.ToString("0.##")%</td>
                            <td class="text-end"><strong>@item.LineTotal.ToString("C")</strong></td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No items in this invoice.
            </div>
        }

        <!-- Totals Section -->
        <div class="totals-section">
            <table class="totals-table">
                <tr>
                    <td>Subtotal:</td>
                    <td class="text-end">@Model.SubTotal.ToString("C")</td>
                </tr>
                @if (Model.DiscountAmount > 0)
                {
                    <tr>
                        <td>Discount:</td>
                        <td class="text-end text-success">-@Model.DiscountAmount.ToString("C")</td>
                    </tr>
                }
                @if (Model.TaxAmount > 0)
                {
                    <tr>
                        <td>Tax:</td>
                        <td class="text-end">@Model.TaxAmount.ToString("C")</td>
                    </tr>
                }
                <tr class="total-row">
                    <td><strong>Total Amount:</strong></td>
                    <td class="text-end"><strong>@Model.TotalAmount.ToString("C")</strong></td>
                </tr>
                @if (Model.PaidAmount > 0)
                {
                    <tr>
                        <td>Paid Amount:</td>
                        <td class="text-end text-success">@Model.PaidAmount.ToString("C")</td>
                    </tr>
                    <tr>
                        <td><strong>Balance Due:</strong></td>
                        <td class="text-end"><strong>@Model.Balance.ToString("C")</strong></td>
                    </tr>
                }
            </table>
        </div>

        <!-- Notes Section -->
        @if (!string.IsNullOrEmpty(Model.Notes))
        {
            <div class="section-header">Notes</div>
            <div class="alert alert-light">
                @Model.Notes
            </div>
        }

        <!-- Footer Information -->
        <div class="footer-info">
            <div class="row">
                <div class="col-md-6">
                    <strong>Thank you for your business!</strong><br>
                    If you have any questions about this invoice, please contact us.
                </div>
                <div class="col-md-6 text-end">
                    <small>
                        Invoice created on @Model.CreatedAt.ToString("MMMM dd, yyyy") by @Model.CreatedByUser<br>
                        Generated on @DateTime.Now.ToString("MMMM dd, yyyy 'at' h:mm tt")
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <script>
        // Auto-focus print dialog when page loads (optional)
        // window.addEventListener('load', function() {
        //     setTimeout(function() {
        //         window.print();
        //     }, 500);
        // });
        
        // Handle print button click
        function printInvoice() {
            window.print();
        }
        
        // Handle close button click
        function closeWindow() {
            window.close();
        }
    </script>
</body>
</html>
