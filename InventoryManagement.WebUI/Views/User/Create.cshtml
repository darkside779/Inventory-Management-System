@model InventoryManagement.WebUI.ViewModels.Users.CreateUserViewModel

@{
    ViewData["Title"] = "Create User";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-user-plus"></i> Create New User
        </h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-action="Index">Users</a></li>
                <li class="breadcrumb-item active" aria-current="page">Create</li>
            </ol>
        </nav>
    </div>

    <!-- Create User Form -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-user-circle"></i> User Information
                    </h6>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post" novalidate>
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Username" class="form-label">
                                        <i class="fas fa-at text-muted"></i> Username <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="Username" class="form-control" placeholder="Enter username" />
                                    <span asp-validation-for="Username" class="text-danger"></span>
                                    <small class="form-text text-muted">
                                        Username must be unique and can contain letters, numbers, dots, hyphens, and underscores.
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Email" class="form-label">
                                        <i class="fas fa-envelope text-muted"></i> Email Address <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="Email" class="form-control" placeholder="Enter email address" />
                                    <span asp-validation-for="Email" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label asp-for="FullName" class="form-label">
                                <i class="fas fa-user text-muted"></i> Full Name <span class="text-danger">*</span>
                            </label>
                            <input asp-for="FullName" class="form-control" placeholder="Enter full name" />
                            <span asp-validation-for="FullName" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="PhoneNumber" class="form-label">
                                <i class="fas fa-phone text-muted"></i> Phone Number
                            </label>
                            <input asp-for="PhoneNumber" class="form-control" placeholder="Enter phone number (optional)" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Password" class="form-label">
                                        <i class="fas fa-lock text-muted"></i> Password <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="Password" class="form-control" placeholder="Enter password" />
                                    <span asp-validation-for="Password" class="text-danger"></span>
                                    <small class="form-text text-muted">
                                        Password must be at least 6 characters long.
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="ConfirmPassword" class="form-label">
                                        <i class="fas fa-lock text-muted"></i> Confirm Password <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="ConfirmPassword" class="form-control" placeholder="Confirm password" />
                                    <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Role" class="form-label">
                                        <i class="fas fa-user-tag text-muted"></i> Role <span class="text-danger">*</span>
                                    </label>
                                    <select asp-for="Role" asp-items="Model.RoleOptions" class="form-control">
                                        <option value="">Select a role...</option>
                                    </select>
                                    <span asp-validation-for="Role" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div class="mt-4 pt-2">
                                        <div class="form-check">
                                            <input asp-for="IsActive" class="form-check-input" />
                                            <label asp-for="IsActive" class="form-check-label">
                                                <i class="fas fa-toggle-on text-success"></i> Active User
                                            </label>
                                        </div>
                                        <small class="form-text text-muted">
                                            Inactive users cannot log in to the system.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input asp-for="SendWelcomeEmail" class="form-check-input" />
                                <label asp-for="SendWelcomeEmail" class="form-check-label">
                                    <i class="fas fa-envelope-open text-info"></i> Send Welcome Email
                                </label>
                            </div>
                            <small class="form-text text-muted">
                                Send an email to the user with their login credentials and system information.
                            </small>
                        </div>

                        <hr>

                        <div class="form-group mb-0">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Create User
                            </button>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Help Panel -->
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-info">
                        <i class="fas fa-info-circle"></i> User Roles
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6 class="text-danger">
                            <i class="fas fa-user-shield"></i> Administrator
                        </h6>
                        <p class="small text-muted mb-2">
                            Full system access including user management, system settings, and all modules.
                        </p>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="text-warning">
                            <i class="fas fa-user-tie"></i> Manager
                        </h6>
                        <p class="small text-muted mb-2">
                            Access to inventory management, reporting, and staff supervision. Cannot manage administrators.
                        </p>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="text-info">
                            <i class="fas fa-user"></i> Staff
                        </h6>
                        <p class="small text-muted mb-2">
                            Limited access to transaction processing and basic inventory operations.
                        </p>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-warning">
                        <i class="fas fa-exclamation-triangle"></i> Security Guidelines
                    </h6>
                </div>
                <div class="card-body">
                    <ul class="small text-muted mb-0">
                        <li>Use strong, unique passwords</li>
                        <li>Verify email addresses before creating accounts</li>
                        <li>Assign the minimum required role for user responsibilities</li>
                        <li>Review user permissions regularly</li>
                        <li>Deactivate accounts immediately when users leave</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Real-time password strength indicator
            $('#Password').on('input', function() {
                var password = $(this).val();
                var strength = getPasswordStrength(password);
                updatePasswordStrengthIndicator(strength);
            });

            // Username availability check (simulated)
            $('#Username').on('blur', function() {
                var username = $(this).val();
                if (username.length >= 3) {
                    checkUsernameAvailability(username);
                }
            });

            // Email format validation
            $('#Email').on('blur', function() {
                var email = $(this).val();
                if (email && !isValidEmail(email)) {
                    showFieldError('Email', 'Please enter a valid email address.');
                } else {
                    clearFieldError('Email');
                }
            });
        });

        function getPasswordStrength(password) {
            var score = 0;
            if (password.length >= 8) score++;
            if (/[a-z]/.test(password)) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^a-zA-Z0-9]/.test(password)) score++;
            return score;
        }

        function updatePasswordStrengthIndicator(strength) {
            var indicator = $('#password-strength');
            if (indicator.length === 0) {
                $('#Password').after('<div id="password-strength" class="mt-1"></div>');
                indicator = $('#password-strength');
            }

            var colors = ['danger', 'danger', 'warning', 'info', 'success'];
            var texts = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'];
            
            if (strength === 0) {
                indicator.html('');
                return;
            }

            var colorClass = colors[strength - 1];
            var text = texts[strength - 1];
            
            indicator.html(`<small class="text-${colorClass}">Password Strength: ${text}</small>`);
        }

        function checkUsernameAvailability(username) {
            // Simulate username availability check
            // In a real implementation, this would make an AJAX call to the server
            setTimeout(function() {
                if (username.toLowerCase() === 'admin' || username.toLowerCase() === 'test') {
                    showFieldError('Username', 'This username is not available.');
                } else {
                    clearFieldError('Username');
                }
            }, 500);
        }

        function isValidEmail(email) {
            var regex = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;
            return regex.test(email);
        }

        function showFieldError(fieldName, message) {
            var field = $(`#${fieldName}`);
            var errorSpan = field.siblings('.text-danger');
            
            field.addClass('is-invalid');
            if (errorSpan.length > 0) {
                errorSpan.text(message);
            } else {
                field.after(`<span class="text-danger">${message}</span>`);
            }
        }

        function clearFieldError(fieldName) {
            var field = $(`#${fieldName}`);
            field.removeClass('is-invalid');
            field.siblings('.text-danger').text('');
        }
    </script>
}
